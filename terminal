# Grant Storage Object Admin role to the service account for the bucket
gcloud storage buckets add-iam-policy-binding gs://aurite-dev-embeddings \
    --member="serviceAccount:txtai-service@aurite-dev.iam.gserviceaccount.com" \
    --role="roles/storage.objectAdmin"

# Also grant Storage Viewer role to allow bucket listing/metadata
gcloud storage buckets add-iam-policy-binding gs://aurite-dev-embeddings \
    --member="serviceAccount:txtai-service@aurite-dev.iam.gserviceaccount.com" \
    --role="roles/storage.legacyBucketReader"

# Create new key for existing service account
gcloud iam service-accounts keys create ./config/service-account.json \
    --iam-account=txtai-service@aurite-dev.iam.gserviceaccount.com

# Run the diagnostic script again to verify
python scripts/check_gcp_auth.py

# From notebook 46: Custom indices need defaults=False
# From notebook 30: SQL queries are the preferred way to handle metadata
# From notebook 45: The document format should use standard field names
# From notebook 61: Proper metadata handling is critical for search results
